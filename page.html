<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Chat me</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<style>
		html, body {
			height: 100%;
			margin: 0px;
			padding: 0px;
			font-size: 14px;
		}
		*{
			font-family: Verdana, sans-serif;
		}
		#controlPanel {
			background-color: #DD9EEB;
			height: 100%;
			float: left;
		}

		#display {
			padding-top: 10px;
			padding-left: 10px;
			height: 100%;
			background-color: #eec0c6;
			background-image: linear-gradient(315deg, #eec0c6 0%, #7ee8fa 60%);


			overflow: scroll;
		}
		.panelTitle {
			padding: 0;
			margin: 0;
			color: #000000;
			text-align: center;
		}


		#checkMessagesToPanel, #checkMessagesFromPanel, #newUserPanel, #newMessagePanel{
			border: 1px solid black;
			position: relative;
			padding-left: 3px;
			padding-right: 3px;
		}
		input[type=text] {
			width: 125px;
			position: absolute;
			right: 0px;
		}
		input[type=password] {
			width: 125px;
			position: absolute;
			right: 0px;
		}
		#responseTextHere{
			font-size: 24px;
			text-align: center;
		}
		#displayMessagesHeader{
			font-size: 36px;
			position: relative;
			left: 10px;
		}
		#displayMessagesHeader > span{
			position: absolute;
			font-size: 24px;
			left: 10px;
		}
		.messageElement{
			border: 1.5mm ridge rgba(211, 220, 50, .6);
  		width: fit-content;
			height: 1.5em;
			background-color: #eec0c6;
			font-size: 20px;
		}
		.userElement{
			border: 1.5mm ridge rgba(211, 220, 50, .6);
  		width: fit-content;
			height: 1.5em;
			background-color: #eec0c6;
			font-size: 20px;
		}

		#suButton{
			position: absolute;
			left: 10px;
		}

	</style>

</head>






<body>

	<div id="controlPanel">

		<div id="checkMessagesToPanel">
			<p class="panelTitle"><b>Check Your Messages</b></p>
			<form autocomplete="off" action="javascript:checkMessagesTo();" method="GET">
				<span id="to1">To:</span> <input autocomplete="off" type="text" name="to" id="checkMessagesTo"></input><br>
				<input type="submit"></input>
			</form>
		</div>

		<div id="checkMessagesFromPanel">
			<p class="panelTitle"><b>Check Messages You Have Sent</b></p>
			<form autocomplete="off" action="javascript:checkMessagesFrom();" method="GET">
				<span id="from1">From:</span> <input autocomplete="off" type="text" id="checkMessagesFrom"></input><br>
				<input type="submit"></input>
			</form>
		</div>

		<div id="newMessagePanel">
			<p class="panelTitle"><b>Send a Message</b></p>
			<form autocomplete="off" id="createMessageForm" action="javascript:createMessage();" method="POST">
				<span id="from2">From: </span><input autocomplete="off" type="text" id="newMessageFrom"></input><br>
				<span id="to2">To:</span> <input autocomplete="off" type="text" id="newMessageTo" placeholder="user1, user2, user3"></input><br>
				<span id="body">Message:</span><br>
				<textarea rows=6 cols=30 id="newMessageMessage"></textarea><br>
				<input type="submit"></input>
			</form>
		</div>

		<div id="newUserPanel">
			<p class="panelTitle"><b>Create New User</b></p>
			<form autocomplete="off" id="newUserForm" action="javascript:createUser();" method="POST">
				<span id="username">Username: </span><input autocomplete="off" type="text" id="createUserUsername"></input><br>
				<span id="password">Password: </span><input autocomplete="off" type="password" id="createUserPassword"></input><br>
				<span id="email">Email (optional): </span><input autocomplete="off" type="text" id="createUserEmail"></input><br>
				<input type="submit"></input>
			</form>
		</div>
		<br>
		<button type="button" id="suButton">Show all users</button> <br> <br>


	</div>

	<div id="display">

		<div id="responseTextHere"><div id="displayMessagesHeader">Start by creating a user or clicking the <i>Show all users</i> button.</div></div>
	</div>








	<script src="/socket.io/socket.io.js"></script>
	<script>

	var socket = io();
	socket.on('listAllUsers',function(response){
		var responseText = "<div id='displayMessagesHeader'>Here are all of the users in the database:<br><span>Click on a user to automatically put them in the \"To\" field.</span></div><br><br>";
		for(var i=0; i<response.length; i++){
			responseText+= "<div class='userElement' onclick='changeTo(\"" + response[i]["username"]+"\")'> ➼ " + response[i]["username"] + "</div>";
		}
		responseTextHere.innerHTML = responseText;
	});
	socket.on('createUser',function(response){
		responseTextHere.innerHTML = response;
	});
	socket.on('createMessage',function(response){
		responseTextHere.innerHTML = response;
	});
	socket.on('userDNE',function(response){
		responseTextHere.innerHTML = "User <i>"+response+"</i> does not exist.";
	});
	socket.on('noMessages',function(response){
		if(response["type"] == "from"){
			responseTextHere.innerHTML = "User <i>" + response["username"]+"</i> has not sent any messages!";
		} else if(response["type"] == "to"){
			responseTextHere.innerHTML = "User <i>" + response["username"]+"</i> has not received any messages!";
		}
	});
	socket.on('checkMessagesFrom',function(response){
		var responseText = "<div id='displayMessagesHeader'>Here are the messages that you have sent, <i>" + response[0]["from"] +"</i>:</div><br>";
		for(let i=0; i<response.length; i++){
			responseText += "<div class=\"messageElement\"><strong> ➼ To "+response[i]["to"]+":</strong> "+response[i]["body"]+"</div>";
		}
		responseTextHere.innerHTML = responseText;
	});
	socket.on('checkMessagesTo',function(response){
		var responseText = "<div id='displayMessagesHeader'>Here are your messages, <i>" + response[0]["to"] +"</i>:</div><br>";
		for(let i=0; i<response.length; i++){
			responseText += "<div class=\"messageElement\"><strong> ➼ From "+response[i]["from"]+":</strong> "+response[i]["body"]+"</div>";
		}
		responseTextHere.innerHTML = responseText;
	});



	$(document).ready(function(){
		let display = document.getElementById('display');

		$("#suButton").click(function(){
			socket.emit('listAllUsers');
		});

		$('input, textarea, select')
                .not(':input[type=button], :input[type=submit], :input[type=reset]').focus(function(){
			$(this).css("background-color","#cccccc");
		});
		$('input, textarea, select')
                .not(':input[type=button], :input[type=submit], :input[type=reset]').blur(function(){
			$(this).css("background-color","#ffffff");
		});
	});


		function changeTo(user){
			document.getElementById("newMessageTo").value = user;
		}
		function checkMessagesTo() {
			var to = document.getElementById("checkMessagesTo").value;
			if(to!="")
			socket.emit('checkMessagesTo',{"username":to});
		}

		function checkMessagesFrom() {
			var from = document.getElementById("checkMessagesFrom").value;
			if(from!="")
			socket.emit('checkMessagesFrom',{"username":from});
		}

		function createMessage(){
			var from = document.getElementById("newMessageFrom").value;
			var to = document.getElementById("newMessageTo").value;
			var message = document.getElementById("newMessageMessage").value;
			if(message=="") document.getElementById("responseTextHere").innerHTML = "Oops! Your message is empty.";
			else if(from=="" || to=="") document.getElementById("responseTextHere").innerHTML =
			"Make sure you enter who the message is from and to!";
			else {
				socket.emit('createMessage',{"from":from,"to":to,"body":message});
				document.getElementById("createMessageForm").reset();
			}
		}

		function createUser(){
			var username = document.getElementById("createUserUsername").value;
			var password = document.getElementById("createUserPassword").value;
			var email = document.getElementById("createUserEmail").value;
			if(username=="") document.getElementById("responseTextHere").innerHTML = "Make sure you enter a username.";
			else if(password=="") document.getElementById("responseTextHere").innerHTML = "Make sure you enter a password.";
			else{
				socket.emit('createUser',{"username":username,"password":password,"email":email});
				document.getElementById("newUserForm").reset();
			}
		}



	</script>

</body>
</html>
